---
title: "Objective 1a: Descriptive analysis of baseline child outcomes (_el by arm_primary and sex)"
author: "Pearl Ante-Testard"
data: "`r Sys.Date()`"
output: html_document
knit: (function(inputFile, encoding){
    rmarkdown::render(inputFile,
                      encoding = encoding,
                      output_dir = here::here("output"))})
---

First, we will conduct a descriptive analysis of the mean or prevalence (binary outcomes) of different child outcomes each study.

Intervention: arms_primary 
Outcome: _el suffixes correspond to the selected endline for that study


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r clean environment, echo = TRUE, warning = FALSE}

rm(list=ls(all=TRUE))
```

```{r configuration, echo = TRUE, warning = FALSE}

source(here::here("R", "0-config.R"))

```

```{r load data, echo = TRUE, warning = FALSE}

df_analysis <- readRDS(here::here("data", "1-final",
                      "df_analysis_iwi.rds")) %>% 
  dplyr::mutate(study = sub("s[0-9]*_", "", study.x)) %>%
  dplyr::filter(!is.na(arm_primary)) %>%
  dplyr::mutate(arm_primary = factor(arm_primary, levels = c(0,1), 
                              labels = c("Control","Intervention")))

```

## Growth outcomes

LAZ

```{r laz, echo = TRUE, warning = FALSE}

# Calculate the mean laz_el by study 
mean_values_laz <- df_analysis %>%
  group_by(study, arm_primary
           ) %>%
  summarise(
    mean_laz_el = mean(laz_el, na.rm = TRUE)
  ) 

# Calculate the overall mean laz_el by study
overall_means_laz <- df_analysis %>%
  group_by(study) %>%
  summarise(
    overall_mean_laz_el = mean(laz_el, na.rm = TRUE)
  )

# Create the lollipop plot
plot_laz <- #ggplot(mean_values_laz, aes(x = study, y = mean_laz_el, 
                                        #color = arm_primary)) +
            ggplot(mean_values_laz, aes(x = reorder(study, -mean_laz_el), 
                                        y = mean_laz_el, color = arm_primary)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arm_primary)), size = 3) +
            scale_shape_manual(name = "Intervention", 
                               values = c("Control" = 16, "Intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Mean LAZ at endline", color = "Intervention",
                 shape = "Intervention", fill = "Intervention") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(-2.5,0.25))


plot_laz

```

```{r save plot 1, echo = TRUE, warning = FALSE}
# Save the plot as a PNG
ggsave(here::here("output","lollipop_plot_laz_el_primary.png"), plot = plot_laz, width = 10, height = 6, dpi = 300)

```

WLZ

```{r wlz, echo = TRUE, warning = FALSE}

# Calculate the mean wlz_el by study 
mean_values_wlz <- df_analysis %>%
  group_by(study, arm_primary
           ) %>%
  summarise(
    mean_wlz_el = mean(wlz_el, na.rm = TRUE)
  ) 

# Calculate the overall mean laz_el by study
overall_means_laz <- df_analysis %>%
  group_by(study) %>%
  summarise(
    overall_mean_wlz_el = mean(wlz_el, na.rm = TRUE)
  )

# Create the lollipop plot
plot_wlz <- #ggplot(mean_values_wlz, aes(x = study, y = mean_wlz_el, 
                                        #color = arm_primary)) +
            ggplot(mean_values_wlz, aes(x = reorder(study, -mean_wlz_el), 
                                        y = mean_wlz_el, color = arm_primary)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arm_primary)), size = 3) +
            scale_shape_manual(name = "Intervention", 
                               values = c("Control" = 16, "Intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Mean WLZ at endline", color = "Intervention",
                 shape = "Intervention", fill = "Intervention") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(-2.5,0.25))

plot_wlz

```

```{r save plot 2, echo = TRUE, warning = FALSE}
# Save the plot as a PNG
ggsave(here::here("output","lollipop_plot_wlz_el_primary.png"), plot = plot_wlz, width = 10, height = 6, dpi = 300)

```

Prevalence of binary outcomes

Stunting

```{r stunting-wasting, echo = TRUE, warning = FALSE}

# Calculate the prevalence of stunted_el by study
prevalence_values_stunted <- df_analysis %>%
  group_by(study, arm_primary) %>%
  summarise(
    prevalence_stunted_el = mean(stunted_el == 1, na.rm = TRUE)
  ) 

# Calculate the overall prevalence of stunted_el by study
overall_prevalence_stunted <- df_analysis %>%
  group_by(study) %>%
  summarise(
    prevalence_stunted_el = mean(stunted_el == 1, na.rm = TRUE)  # Calculate the prevalence
  )

# Create the lollipop plot
plot_stunted <- #ggplot(prevalence_values_stunted, aes(x = study, 
                                            # y = prevalence_stunted_el*100, 
                                        #color = arm_primary)) +
            ggplot(prevalence_values_stunted, 
                   aes(x = reorder(study, prevalence_stunted_el*100), 
                                        y = prevalence_stunted_el*100, 
                                        color = arm_primary)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arm_primary)), size = 3) +
            scale_shape_manual(name = "Intervention", 
                               values = c("Control" = 16, "Intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Stunting (%)", color = "Intervention",
                 shape = "Intervention", fill = "Intervention") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(0,60))

plot_stunted
```

```{r save plot 3, echo = TRUE, warning = FALSE}
# Save the plot as a PNG
ggsave(here::here("output","lollipop_plot_stunted_el_primary.png"), plot = plot_stunted, width = 10, height = 6, dpi = 300)

```

Wasting

```{r wasting, echo = TRUE, warning = FALSE}

# Calculate the prevalence of wasted_el by study
prevalence_values_wasted <- df_analysis %>%
  group_by(study, arm_primary) %>%
  summarise(
    prevalence_wasted_el = mean(wasted_el == 1, na.rm = TRUE)
  ) 

# Calculate the overall prevalence of wasted_el by study
overall_prevalence_stunted <- df_analysis %>%
  group_by(study) %>%
  summarise(
    prevalence_wasted_el = mean(wasted_el == 1, na.rm = TRUE)  # Calculate the prevalence
  )

# Create the lollipop plot
plot_wasted <- #ggplot(prevalence_values_wasted, aes(x = study, 
                                                    #  y = prevalence_wasted_el*100, 
                                        #color = arm_primary)) +
            ggplot(prevalence_values_wasted, 
                   aes(x = reorder(study, prevalence_wasted_el*100), 
                                        y = prevalence_wasted_el*100, 
                                        color = arm_primary)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arm_primary)), size = 3) +
            scale_shape_manual(name = "Intervention", 
                               values = c("Control" = 16, "Intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Wasting (%)", 
                 color = "Intervention",
                 shape = "Intervention", fill = "Intervention") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(0,60))

plot_wasted

```

```{r save plot 4, echo = TRUE, warning = FALSE}
# Save the plot as a PNG
ggsave(here::here("output","lollipop_plot_wasted_el_primary.png"), plot = plot_wasted, width = 10, height = 6, dpi = 300)

```

Severe stunting

```{r severe stunting, echo = TRUE, warning = FALSE}

# Create the 'severe_stunted' variable
df_analysis <- df_analysis %>%
  mutate(severe_stunted = case_when(laz_el < -3 ~ 1, 
                                    laz_el >= -3 ~ 0))

# Calculate the prevalence of 'severe_stunted' by study
prevalence_values_severe_stunted <- df_analysis %>%
  group_by(study, arm_primary) %>%
  summarise(
    prevalence_severe_stunted = mean(severe_stunted == 1, na.rm = TRUE)
  ) 

# Calculate the overall prevalence of 'severe_stunted' by study
overall_prevalence_severe_stunted <- df_analysis %>%
  group_by(study) %>%
  summarise(
    prevalence_severe_stunted = mean(severe_stunted == 1, na.rm = TRUE)  # Calculate the prevalence
  )

# Create the lollipop plot
plot_severe_stunting <- #ggplot(prevalence_values_severe_stunted, 
                              # aes(x = study, y = prevalence_severe_stunted*100, 
                                 #       color = arm_primary)) +
            ggplot(prevalence_values_severe_stunted, 
                   aes(x = reorder(study, prevalence_severe_stunted*100), 
                                        y = prevalence_severe_stunted*100, 
                                        color = arm_primary)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arm_primary)), size = 3) +
            scale_shape_manual(name = "Intervention", 
                               values = c("Control" = 16, "Intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Severe stunting (%)", 
                 color = "Intervention",
                 shape = "Intervention", fill = "Intervention") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(0,60))


plot_severe_stunting

```

```{r save plot 5, echo = TRUE, warning = FALSE}
# Save the plot as a PNG
ggsave(here::here("output","lollipop_plot_severe_stunting_el_primary.png"), plot = plot_severe_stunting, width = 10, height = 6, dpi = 300)

```


Severe wasting

```{r severe wasting, echo = TRUE, warning = FALSE}

# Create the 'severe_wasted' variable
df_analysis <- df_analysis %>%
  mutate(severe_wasted = case_when(wlz_el < -3 ~ 1, 
                                    wlz_el >= -3 ~ 0))


# Calculate the prevalence of 'severe_wasted' by study
prevalence_values_severe_wasted <- df_analysis %>%
  group_by(study, arm_primary) %>%
  summarise(
    prevalence_severe_wasted = mean(severe_wasted == 1, na.rm = TRUE)
  ) 

# Calculate the overall prevalence of 'severe_stunted' by study
overall_prevalence_severe_wasted <- df_analysis %>%
  group_by(study) %>%
  summarise(
    prevalence_severe_wasted = mean(severe_wasted == 1, na.rm = TRUE))  # Calculate the prevalence

# Create the lollipop plot
plot_severe_wasting <- #ggplot(prevalence_values_severe_wasted, 
                               #aes(x = study, y = prevalence_severe_wasted*100, 
                                       # color = arm_primary)) +
            ggplot(prevalence_values_severe_wasted, 
                   aes(x = reorder(study, prevalence_severe_wasted*100), 
                                        y = prevalence_severe_wasted*100, 
                                        color = arm_primary)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arm_primary)), size = 3) +
            scale_shape_manual(name = "Intervention", 
                               values = c("Control" = 16, "Intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Severe wasting (%)", 
                 color = "Intervention",
                 shape = "Intervention", fill = "Intervention") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(0,60))


plot_severe_wasting

```

```{r save plot 6, echo = TRUE, warning = FALSE}
# Save the plot as a PNG
ggsave(here::here("output","lollipop_plot_severe_wasting_el_primary.png"), plot = plot_severe_wasting, width = 10, height = 6, dpi = 300)

```

Combining plots

```{r combine plots 5, echo = TRUE, warning = FALSE}

# Combine the plots
combined_plots_laz <- grid.arrange(plot_laz, plot_stunted, plot_severe_stunting, ncol = 3, nrow = 1)

combinedd_plots_wlz <- grid.arrange(plot_wlz, plot_wasted, plot_severe_wasting, ncol = 3, nrow = 1)

combined_laz_wlz <- grid.arrange(combined_plots_laz, combinedd_plots_wlz, ncol = 1, nrow = 2)

combined_laz_wlz
```

```{r save combined plots 5, echo = TRUE, warning = FALSE}

# Save the combined plots as a PNG
ggsave(here::here("output","combined_lollipop_laz_wlz_primary.png"), plot = combined_laz_wlz, width = 15, height = 10, dpi = 300)
```



## Developmental outcomes

Language score

```{r language score, echo = TRUE, warning = FALSE}

# Calculate the mean language score
mean_values_d1_lang_el <- df_analysis %>%
  filter(!is.na(d1_lang_el)) %>%  # Filter out NA values in 'd1_lang_el'
  group_by(study, arm_primary) %>%
  summarise(
    mean_d1_lang_el = mean(d1_lang_el, na.rm = TRUE)
  ) 

# Calculate the overall mean d1_lang_el by study
overall_means_d1_lang <- df_analysis %>%
  group_by(study) %>%
  summarise(
    overall_mean_d1_lang_el = mean(d1_lang_el, na.rm = TRUE)
  )

# Create the lollipop plot
plot_lang_score <- #ggplot(mean_values_wlz, aes(x = study, y = mean_wlz_el, 
                                        #color = arm_primary)) +
            ggplot(mean_values_d1_lang_el, aes(x = reorder(study, -mean_d1_lang_el), 
                                        y = mean_d1_lang_el, color = arm_primary)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arm_primary)), size = 3) +
            scale_shape_manual(name = "Intervention", 
                               values = c("Control" = 16, "Intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Mean language score at endline", 
                 color = "Intervention",
                 shape = "Intervention", fill = "Intervention") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(-0.3,0.13))



plot_lang_score

```

```{r save plot 7, echo = TRUE, warning = FALSE}
# Save the plot as a PNG

ggsave(here::here("output","lollipop_plot_lang_score_el_primary.png"), plot = plot_lang_score, width = 10, height = 6, dpi = 300)

```

Gross motor skill

```{r gross motor skill, echo = TRUE, warning = FALSE}

# Calculate the mean gross motor skill score d8_grossmotor_el
mean_values_d8_grossmotor_el <- df_analysis %>%
  filter(!is.na(d8_grossmotor_el)) %>%  # Filter out NA values in 'd8_grossmotor_el'
  group_by(study, arm_primary) %>%
  summarise(
    mean_d8_grossmotor_el = mean(d8_grossmotor_el, na.rm = TRUE)
  ) 

# Calculate the overall mean d8_grossmotor_el by study
overall_means_d8_grossmotor <- df_analysis %>%
  group_by(study) %>%
  summarise(
    overall_mean_d8_grossmotor_el = mean(d8_grossmotor_el, na.rm = TRUE)
  )

# Create the lollipop plot
plot_gross_motor <- #ggplot(mean_values_d8_grossmotor_el, aes(x = study, y = mean_d8_grossmotor_el, color = female)) +
  ggplot(mean_values_d8_grossmotor_el, aes(x = study, y = mean_d8_grossmotor_el, color = female)) +
  geom_segment(aes(xend = study, yend = 0), color = "black") +
  geom_point(aes(shape = as.factor(arm_primary)), size = 3) +
  geom_point(data = overall_means_d8_grossmotor, aes(x = reorder(study, -overall_mean_d8_grossmotor_el), y = overall_mean_d8_grossmotor_el), color = "grey") +  # Add points for the overall prevalence
  scale_shape_manual(name = "Intervention", values = c("0" = 16, "1" = 17)) +  # 16 is the shape code for circle, 17 for triangle
  theme_minimal() +
  coord_flip() +  # Make the plot horizontal
  labs(title = "Mean d8_grossmotor_el by study stratified by arm and sex", x = "Study", y = "Mean d8_grossmotor_el") +
  scale_color_discrete(name = "Sex") +
  theme(legend.position = "bottom")

plot_gross_motor <- #ggplot(mean_values_wlz, aes(x = study, y = mean_wlz_el, 
                                        #color = arm_primary)) +
            ggplot(mean_values_d8_grossmotor_el, 
                   aes(x = reorder(study, -mean_d8_grossmotor_el), 
                                        y = mean_d8_grossmotor_el, 
                       color = arm_primary)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arm_primary)), size = 3) +
            scale_shape_manual(name = "Intervention", 
                               values = c("Control" = 16, "Intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Mean gross motor score at endline", 
                 color = "Intervention",
                 shape = "Intervention", fill = "Intervention") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(-0.3,0.13))

plot_gross_motor
                                                    
```

```{r save plot 8, echo = TRUE, warning = FALSE}
# Save the plot as a PNG

ggsave(here::here("output","lollipop_plot_gross_motor_el_primary.png"), plot = plot_gross_motor, width = 10, height = 6, dpi = 300)

```

Fine motor skill

```{r fine motor skill, echo = TRUE, warning = FALSE}

# Calculate the mean fine motor skill score d10_finemotor_el
mean_values_d10_finemotor_el <- df_analysis %>%
  group_by(study, arm_primary) %>%
  summarise(
    mean_d10_finemotor_el = mean(d10_finemotor_el, na.rm = TRUE)
  ) 

# Calculate the overall mean d10_finemotor_el by study
overall_means_d10_finemotor <- df_analysis %>%
  group_by(study) %>%
  summarise(
    overall_mean_d10_finemotor_el = mean(d10_finemotor_el, na.rm = TRUE)
  )

# Create the lollipop plot
plot_fine_motor <- ggplot(mean_values_d10_finemotor_el, 
                   aes(x = reorder(study, -mean_d10_finemotor_el), 
                                        y = mean_d10_finemotor_el, 
                       color = arm_primary)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arm_primary)), size = 3) +
            scale_shape_manual(name = "Intervention", 
                               values = c("Control" = 16, "Intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Mean fine motor score at endline", 
                 color = "Intervention",
                 shape = "Intervention", fill = "Intervention") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(-0.3,0.13))


plot_fine_motor
                                                    
```

```{r save plot 9, echo = TRUE, warning = FALSE}
# Save the plot as a PNG

ggsave(here::here("output","lollipop_plot_fine_motor_el_primary.png"), plot = plot_fine_motor, width = 10, height = 6, dpi = 300)

```


Executive function score

```{r executive function score, echo = TRUE, warning = FALSE}

# Calculate the mean executive function score d12_execfun_el
mean_values_d12_execfun_el <- df_analysis %>%
  group_by(study, arm_primary) %>%
  summarise(
    mean_d12_execfun_el = mean(d12_execfun_el, na.rm = TRUE)
  ) 

# Calculate the overall mean d12_execfun_el by study
overall_means_d12_execfun <- df_analysis %>%
  group_by(study) %>%
  summarise(
    overall_mean_d12_execfun_el = mean(d12_execfun_el, na.rm = TRUE)
  )

# Create the lollipop plot
plot_exec_fun <- ggplot(mean_values_d12_execfun_el, 
                   aes(x = reorder(study, -mean_d12_execfun_el), 
                                        y = mean_d12_execfun_el, 
                       color = arm_primary)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arm_primary)), size = 3) +
            scale_shape_manual(name = "Intervention", 
                               values = c("Control" = 16, "Intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Mean executive function score at endline", 
                 color = "Intervention",
                 shape = "Intervention", fill = "Intervention") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(-0.3,0.13))

plot_exec_fun

```

```{r save plot 10, echo = TRUE, warning = FALSE}
# Save the plot as a PNG

ggsave(here::here("output","lollipop_plot_exec_fun_el_primary.png"), plot = plot_exec_fun, width = 10, height = 6, dpi = 300)

```

Socioemotional score

```{r socioemotional score, echo = TRUE, warning = FALSE}

# Calculate the mean socioemotional score d5_socioemo_el
mean_values_d5_socioemo_el <- df_analysis %>%
  group_by(study, arm_primary) %>%
  summarise(
    mean_d5_socioemo_el = mean(d5_socioemo_el, na.rm = TRUE)
  ) 

# Calculate the overall mean d12_execfun_el by study
overall_means_d5_socioemo <- df_analysis %>%
  group_by(study) %>%
  summarise(
    overall_mean_d5_socioemo_el = mean(d5_socioemo_el, na.rm = TRUE)
  )

# Create the lollipop plot
plot_socioemo <- ggplot(mean_values_d5_socioemo_el, 
                   aes(x = reorder(study, -mean_d5_socioemo_el), 
                                        y = mean_d5_socioemo_el, 
                       color = arm_primary)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arm_primary)), size = 3) +
            scale_shape_manual(name = "Intervention", 
                               values = c("Control" = 16, "Intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Mean socioemotional score at endline", 
                 color = "Intervention",
                 shape = "Intervention", fill = "Intervention") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(-0.3,0.13))


plot_socioemo

```

```{r save plot 11, echo = TRUE, warning = FALSE}
# Save the plot as a PNG

ggsave(here::here("output","lollipop_plot_socioemo_el_primary.png"), plot = plot_socioemo, width = 10, height = 6, dpi = 300)

```

Combined plots

```{r combine plots 12, echo = TRUE, warning = FALSE}

# Combine the plots
combined_plots_dev <- grid.arrange(plot_lang_score, plot_gross_motor, plot_fine_motor, plot_exec_fun, plot_socioemo, ncol = 2, nrow = 3)
```

```{r save combined plots 13, echo = TRUE, warning = FALSE}
# Save the combined plots as a PNG
ggsave(here::here("output","combined_plots_dev_el_primary.png"), plot = combined_plots_dev, width = 12, height = 14, dpi = 300)

```


## Anemia

Hemoglobin concentration

```{r hemoglobin, echo = TRUE, warning = FALSE}

# Calculate the mean hemoglobin concentration b1_hb_el by study 
mean_values_hb <- df_analysis %>% 
  group_by(study, arm_primary) %>%
  summarise(
    mean_b1_hb_el = mean(b1_hb_el, na.rm = TRUE)
  ) 

# Calculate the overall mean d12_execfun_el by study
overall_means_b1_hb <- df_analysis %>%
  group_by(study) %>%
  summarise(
    overall_mean_b1_hb_el = mean(b1_hb_el, na.rm = TRUE)
  )


# Create the lollipop plot
plot_hb <- ggplot(mean_values_hb, 
                   aes(x = reorder(study, -mean_b1_hb_el), 
                                        y = mean_b1_hb_el, 
                       color = arm_primary)) +
            geom_segment(aes(xend = study, yend = 70), color = "black") +
            geom_point(aes(shape = as.factor(arm_primary)), size = 3) +
            scale_shape_manual(name = "Intervention", 
                               values = c("Control" = 16, "Intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Mean hemoglobin concentration", 
                 color = "Intervention",
                 shape = "Intervention", fill = "Intervention") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) 

plot_hb


```

```{r save plot 14, echo = TRUE, warning = FALSE}
# Save the plot as a PNG

ggsave(here::here("output","lollipop_plot_hb_el_primary.png"), plot = plot_hb, width = 10, height = 6, dpi = 300)

```

Anemia prevalence

```{r anemia prevalence, echo = TRUE, warning = FALSE}

# Calculate the prevalence of anemia b2_anemia_el

prevalence_b2_anemia_el <- df_analysis %>%
  group_by(study, arm_primary) %>%
  summarise(
    prevalence_b2_anemia_el = mean(b2_anemia_el == 1, na.rm = TRUE)  # Calculate the prevalence
  ) 

# Calculate the overall prevalence of wasted_el by study
overall_prevalence_anemia <- df_analysis %>%
  group_by(study) %>%
  summarise(
    overall_prevalence_anemia = mean(b2_anemia_el == 1, na.rm = TRUE)  # Calculate the prevalence
  )

# Create the lollipop plot
plot_anemia <- ggplot(prevalence_b2_anemia_el, 
                   aes(x = reorder(study, prevalence_b2_anemia_el*100), 
                                        y = prevalence_b2_anemia_el*100, 
                       color = arm_primary)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arm_primary)), size = 3) +
            scale_shape_manual(name = "Intervention", 
                               values = c("Control" = 16, "Intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Anemia (%)", 
                 color = "Intervention",
                 shape = "Intervention", fill = "Intervention") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) #+ ylim(c(-0.3,0.13))



plot_anemia

```

```{r save plot 15, echo = TRUE, warning = FALSE}
# Save the plot as a PNG

ggsave(here::here("output","lollipop_plot_anemia_el_primary.png"), plot = plot_anemia, width = 10, height = 6, dpi = 300)

```


Combined plots

```{r combine plots 16, echo = TRUE, warning = FALSE}

# Combine the plots
combined_plots_anemia <- grid.arrange(plot_hb, plot_anemia, ncol = 2, nrow = 1)
```

```{r save combined plots 17, echo = TRUE, warning = FALSE}
# Save the combined plots as a PNG
ggsave(here::here("output","combined_plots_anemia_el_primary.png"), plot = combined_plots_anemia, width = 12, height = 6, dpi = 300)

```


Session info

```{r session info, echo = TRUE, warning = FALSE}
sessionInfo()
  
```





