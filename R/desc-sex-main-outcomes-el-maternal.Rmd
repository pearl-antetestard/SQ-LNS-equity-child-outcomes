---
title: "Objective 1a: Descriptive analysis of child outcomes "
author: "Pearl Ante-Testard"
data: "`r Sys.Date()`"
output: html_document
knit: (function(inputFile, encoding){
    rmarkdown::render(inputFile,
                      encoding = encoding,
                      output_dir = here::here("output"))})
---

First, we will conduct a descriptive analysis of the mean or prevalence (binary outcomes) of different child outcomes each study.

Maternal intervention: arms_maternal 
Outcome: _el suffixes correspond to the selected endline for that study


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r clean environment, echo = TRUE, warning = FALSE}

rm(list=ls(all=TRUE))
```

```{r configuration, echo = TRUE, warning = FALSE}

source(here::here("R", "0-config.R"))

```

```{r load data, echo = TRUE, warning = FALSE}

df_analysis <- readRDS(here::here("data", "1-final",
                      "df_analysis_iwi.rds")) %>% 
  dplyr::mutate(study = sub("s[0-9]*_", "", study.x)) %>%
  dplyr::filter(!is.na(arms_maternal)) %>%
  dplyr::filter(!is.na(female)) %>%
  dplyr::mutate(arms_maternal = factor(arms_maternal, levels = c(0,1), 
                              labels = c("Control","SQ-LNS")),
                is.female = factor(female, levels = c(0,1), 
                                   labels = c("Male", "Female")))

```

## Growth outcomes

LAZ female

```{r laz female, echo = TRUE, warning = FALSE}

df_analysis_female <- df_analysis %>%
  filter(is.female == "Female")


# Calculate the mean laz_el by study 
mean_values_laz_f <- df_analysis_female %>%
  group_by(study, arms_maternal,
           ) %>%
  summarise(
    mean_laz_el = mean(laz_el, na.rm = TRUE)
  ) 

# Calculate the overall mean laz_el by study
overall_means_laz_f <- df_analysis_female %>%
  group_by(study) %>%
  summarise(
    overall_mean_laz_el = mean(laz_el, na.rm = TRUE)
  )

# Create the lollipop plot
plot_laz_f <- #ggplot(mean_values_laz, aes(x = study, y = mean_laz_el, 
                                        #color = arms_maternal)) +
            ggplot(mean_values_laz_f, aes(x = reorder(study, -mean_laz_el), 
                                        y = mean_laz_el, color = arms_maternal)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
            scale_shape_manual(name = "SQ-LNS", 
                               values = c("Control" = 16, "SQ-LNS" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Mean LAZ at endline (female)", color = "SQ-LNS",
                 shape = "SQ-LNS", fill = "SQ-LNS") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(-2.5,0.25))


plot_laz_f

```

# LAZ male

```{r laz female, echo = TRUE, warning = FALSE}

df_analysis_male <- df_analysis %>%
  filter(is.female == "Male")


# Calculate the mean laz_el by study 
mean_values_laz_m <- df_analysis_male %>%
  group_by(study, arms_maternal,
           ) %>%
  summarise(
    mean_laz_el = mean(laz_el, na.rm = TRUE)
  ) 

# Calculate the overall mean laz_el by study
overall_means_laz_m <- df_analysis_male %>%
  group_by(study) %>%
  summarise(
    overall_mean_laz_el = mean(laz_el, na.rm = TRUE)
  )

# Create the lollipop plot
plot_laz_m <- #ggplot(mean_values_laz, aes(x = study, y = mean_laz_el, 
                                        #color = arms_maternal)) +
            ggplot(mean_values_laz_m, aes(x = reorder(study, -mean_laz_el), 
                                        y = mean_laz_el, color = arms_maternal)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
            scale_shape_manual(name = "SQ-LNS", 
                               values = c("Control" = 16, "SQ-LNS" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Mean LAZ at endline (male)", color = "SQ-LNS",
                 shape = "SQ-LNS", fill = "SQ-LNS") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(-2.5,0.25))


plot_laz_m

```



```{r save plot 1, echo = TRUE, warning = FALSE}
# Save the plot as a PNG
#ggsave(here::here("output","lollipop_plot_laz_el_maternal.png"), plot = plot_laz, width = 10, height = 6, dpi = 300)

plot_laz <- plot_laz_f + plot_laz_m

plot_laz

```

WLZ female

```{r wlz female, echo = TRUE, warning = FALSE}

# Calculate the mean wlz_el by study 
mean_values_wlz_f <- df_analysis_female %>%
  group_by(study, arms_maternal
           ) %>%
  summarise(
    mean_wlz_el = mean(wlz_el, na.rm = TRUE)
  ) 

# Calculate the overall mean laz_el by study
overall_means_laz_f <- df_analysis_female %>%
  group_by(study) %>%
  summarise(
    overall_mean_wlz_el = mean(wlz_el, na.rm = TRUE)
  )

# Create the lollipop plot
plot_wlz_f <- #ggplot(mean_values_wlz, aes(x = study, y = mean_wlz_el, 
                                        #color = arms_maternal)) +
            ggplot(mean_values_wlz_f, aes(x = reorder(study, -mean_wlz_el), 
                                        y = mean_wlz_el, color = arms_maternal)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
            scale_shape_manual(name = "SQ-LNS", 
                               values = c("Control" = 16, "SQ-LNS" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Mean WLZ at endline (female)", color = "SQ-LNS",
                 shape = "Maternal intervention", fill = "SQ-LNS") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(-2.5,0.25))

plot_wlz_f

```

WLZ male

```{r wlz male, echo = TRUE, warning = FALSE}

# Calculate the mean wlz_el by study 
mean_values_wlz_m <- df_analysis_male %>%
  group_by(study, arms_maternal
           ) %>%
  summarise(
    mean_wlz_el = mean(wlz_el, na.rm = TRUE)
  ) 

# Calculate the overall mean laz_el by study
overall_means_laz_m <- df_analysis_male %>%
  group_by(study) %>%
  summarise(
    overall_mean_wlz_el = mean(wlz_el, na.rm = TRUE)
  )

# Create the lollipop plot
plot_wlz_m <- #ggplot(mean_values_wlz, aes(x = study, y = mean_wlz_el, 
                                        #color = arms_maternal)) +
            ggplot(mean_values_wlz_m, aes(x = reorder(study, -mean_wlz_el), 
                                        y = mean_wlz_el, color = arms_maternal)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
            scale_shape_manual(name = "SQ-LNS", 
                               values = c("Control" = 16, "SQ-LNS" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Mean WLZ at endline (male)", color = "SQ-LNS",
                 shape = "Maternal intervention", fill = "SQ-LNS") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(-2.5,0.25))

plot_wlz_m

```

```{r save plot 2, echo = TRUE, warning = FALSE}
# Save the plot as a PNG
#ggsave(here::here("output","lollipop_plot_wlz_el_maternal.png"), plot = plot_wlz, width = 10, height = 6, dpi = 300)

plot_wlz <- plot_wlz_f + plot_wlz_m
plot_wlz

```

Prevalence of binary outcomes

Stunting female

```{r stunting-wasting female, echo = TRUE, warning = FALSE}

# Calculate the prevalence of stunted_el by study
prevalence_values_stunted_f <- df_analysis_female %>%
  group_by(study, arms_maternal) %>%
  summarise(
    prevalence_stunted_el = mean(stunted_el == 1, na.rm = TRUE)
  ) 

# Calculate the overall prevalence of stunted_el by study
overall_prevalence_stunted_f <- df_analysis_female %>%
  group_by(study) %>%
  summarise(
    prevalence_stunted_el = mean(stunted_el == 1, na.rm = TRUE)  # Calculate the prevalence
  )

# Create the lollipop plot
plot_stunted_f <- #ggplot(prevalence_values_stunted, aes(x = study, 
                                            # y = prevalence_stunted_el*100, 
                                        #color = arms_maternal)) +
            ggplot(prevalence_values_stunted_f, 
                   aes(x = reorder(study, prevalence_stunted_el*100), 
                                        y = prevalence_stunted_el*100, 
                                        color = arms_maternal)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
            scale_shape_manual(name = "SQ-LNS", 
                               values = c("Control" = 16, "SQ-LNS" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Stunting (%, female)", color = "SQ-LNS",
                 shape = "Maternal intervention", fill = "SQ-LNS") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(0,60))

plot_stunted_f
```

Stunting male

```{r stunting-wasting male, echo = TRUE, warning = FALSE}

# Calculate the prevalence of stunted_el by study
prevalence_values_stunted_m <- df_analysis_male %>%
  group_by(study, arms_maternal) %>%
  summarise(
    prevalence_stunted_el = mean(stunted_el == 1, na.rm = TRUE)
  ) 

# Calculate the overall prevalence of stunted_el by study
overall_prevalence_stunted_m <- df_analysis_male %>%
  group_by(study) %>%
  summarise(
    prevalence_stunted_el = mean(stunted_el == 1, na.rm = TRUE)  # Calculate the prevalence
  )

# Create the lollipop plot
plot_stunted_m <- #ggplot(prevalence_values_stunted, aes(x = study, 
                                            # y = prevalence_stunted_el*100, 
                                        #color = arms_maternal)) +
            ggplot(prevalence_values_stunted_m, 
                   aes(x = reorder(study, prevalence_stunted_el*100), 
                                        y = prevalence_stunted_el*100, 
                                        color = arms_maternal)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
            scale_shape_manual(name = "SQ-LNS", 
                               values = c("Control" = 16, "SQ-LNS" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Stunting (%, male)", color = "SQ-LNS",
                 shape = "Maternal intervention", fill = "SQ-LNS") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(0,60))

plot_stunted_m
```

```{r save plot 3, echo = TRUE, warning = FALSE}
# Save the plot as a PNG
#ggsave(here::here("output","lollipop_plot_stunted_el_maternal.png"), plot = plot_stunted, width = 10, height = 6, dpi = 300)

plot_stunted <- plot_stunted_f + plot_stunted_m
plot_stunted

```

Wasting female

```{r wasting female, echo = TRUE, warning = FALSE}

# Calculate the prevalence of wasted_el by study
prevalence_values_wasted_f <- df_analysis_female %>%
  group_by(study, arms_maternal) %>%
  summarise(
    prevalence_wasted_el = mean(wasted_el == 1, na.rm = TRUE)
  ) 

# Calculate the overall prevalence of wasted_el by study
overall_prevalence_stunted_f <- df_analysis_female %>%
  group_by(study) %>%
  summarise(
    prevalence_wasted_el = mean(wasted_el == 1, na.rm = TRUE)  # Calculate the prevalence
  )

# Create the lollipop plot
plot_wasted_f <- #ggplot(prevalence_values_wasted, aes(x = study, 
                                                    #  y = prevalence_wasted_el*100, 
                                        #color = arms_maternal)) +
            ggplot(prevalence_values_wasted_f, 
                   aes(x = reorder(study, prevalence_wasted_el*100), 
                                        y = prevalence_wasted_el*100, 
                                        color = arms_maternal)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
            scale_shape_manual(name = "SQ-LNS", 
                               values = c("Control" = 16, "SQ-LNS" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Wasting (%, female)", 
                 color = "SQ-LNS",
                 shape = "SQ-LNS", fill = "SQ-LNS") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(0,60))

plot_wasted_f

```

Wasting male

```{r wasting, echo = TRUE, warning = FALSE}

# Calculate the prevalence of wasted_el by study
prevalence_values_wasted_m <- df_analysis_male %>%
  group_by(study, arms_maternal) %>%
  summarise(
    prevalence_wasted_el = mean(wasted_el == 1, na.rm = TRUE)
  ) 

# Calculate the overall prevalence of wasted_el by study
overall_prevalence_stunted_m <- df_analysis_male %>%
  group_by(study) %>%
  summarise(
    prevalence_wasted_el = mean(wasted_el == 1, na.rm = TRUE)  # Calculate the prevalence
  )

# Create the lollipop plot
plot_wasted_m <- #ggplot(prevalence_values_wasted, aes(x = study, 
                                                    #  y = prevalence_wasted_el*100, 
                                        #color = arms_maternal)) +
            ggplot(prevalence_values_wasted_m, 
                   aes(x = reorder(study, prevalence_wasted_el*100), 
                                        y = prevalence_wasted_el*100, 
                                        color = arms_maternal)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
            scale_shape_manual(name = "SQ-LNS", 
                               values = c("Control" = 16, "SQ-LNS" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Wasting (%, male)", 
                 color = "SQ-LNS",
                 shape = "SQ-LNS", fill = "SQ-LNS") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(0,60))

plot_wasted_m

```


```{r save plot 4, echo = TRUE, warning = FALSE}
# Save the plot as a PNG
#ggsave(here::here("output","lollipop_plot_wasted_el_maternal.png"), plot = plot_wasted, width = 10, height = 6, dpi = 300)

plot_wasted <- plot_wasted_f + plot_wasted_m
plot_wasted

```

Severe stunting female

```{r severe stunting female, echo = TRUE, warning = FALSE}

# Create the 'severe_stunted' variable
df_analysis_female <- df_analysis_female %>%
  mutate(severe_stunted = case_when(laz_el < -3 ~ 1, 
                                    laz_el >= -3 ~ 0))

# Calculate the prevalence of 'severe_stunted' by study
prevalence_values_severe_stunted_f <- df_analysis_female %>%
  group_by(study, arms_maternal) %>%
  summarise(
    prevalence_severe_stunted = mean(severe_stunted == 1, na.rm = TRUE)
  ) 

# Calculate the overall prevalence of 'severe_stunted' by study
overall_prevalence_severe_stunted_f <- df_analysis_female %>%
  group_by(study) %>%
  summarise(
    prevalence_severe_stunted = mean(severe_stunted == 1, na.rm = TRUE)  # Calculate the prevalence
  )

# Create the lollipop plot
plot_severe_stunting_f <- #ggplot(prevalence_values_severe_stunted, 
                              # aes(x = study, y = prevalence_severe_stunted*100, 
                                 #       color = arms_maternal)) +
            ggplot(prevalence_values_severe_stunted_f, 
                   aes(x = reorder(study, prevalence_severe_stunted*100), 
                                        y = prevalence_severe_stunted*100, 
                                        color = arms_maternal)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
            scale_shape_manual(name = "SQ-LNS", 
                               values = c("Control" = 16, "SQ-LNS" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Severe stunting (%, female)", 
                 color = "SQ-LNS",
                 shape = "SQ-LNS", fill = "SQ-LNS") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(0,60))


plot_severe_stunting_f

```

Severe stunting male

```{r severe stunting male, echo = TRUE, warning = FALSE}

# Create the 'severe_stunted' variable
df_analysis_male <- df_analysis_male %>%
  mutate(severe_stunted = case_when(laz_el < -3 ~ 1, 
                                    laz_el >= -3 ~ 0))

# Calculate the prevalence of 'severe_stunted' by study
prevalence_values_severe_stunted_m <- df_analysis_male %>%
  group_by(study, arms_maternal) %>%
  summarise(
    prevalence_severe_stunted = mean(severe_stunted == 1, na.rm = TRUE)
  ) 

# Calculate the overall prevalence of 'severe_stunted' by study
overall_prevalence_severe_stunted_m <- df_analysis_male %>%
  group_by(study) %>%
  summarise(
    prevalence_severe_stunted = mean(severe_stunted == 1, na.rm = TRUE)  # Calculate the prevalence
  )

# Create the lollipop plot
plot_severe_stunting_m <- #ggplot(prevalence_values_severe_stunted, 
                              # aes(x = study, y = prevalence_severe_stunted*100, 
                                 #       color = arms_maternal)) +
            ggplot(prevalence_values_severe_stunted_m, 
                   aes(x = reorder(study, prevalence_severe_stunted*100), 
                                        y = prevalence_severe_stunted*100, 
                                        color = arms_maternal)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
            scale_shape_manual(name = "SQ-LNS", 
                               values = c("Control" = 16, "SQ-LNS" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Severe stunting (%, male)", 
                 color = "SQ-LNS",
                 shape = "SQ-LNS", fill = "SQ-LNS") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(0,60))


plot_severe_stunting_m

```


```{r save plot 5, echo = TRUE, warning = FALSE}
# Save the plot as a PNG
#ggsave(here::here("output","lollipop_plot_severe_stunting_el_maternal.png"), plot = plot_severe_stunting, width = 10, height = 6, dpi = 300)

plot_severe_stunting <- plot_severe_stunting_f + plot_severe_stunting_m
plot_severe_stunting

```


Severe wasting female

```{r severe wasting female, echo = TRUE, warning = FALSE}

# Create the 'severe_wasted' variable
df_analysis_female <- df_analysis_female %>%
  mutate(severe_wasted = case_when(wlz_el < -3 ~ 1, 
                                    wlz_el >= -3 ~ 0))


# Calculate the prevalence of 'severe_wasted' by study
prevalence_values_severe_wasted_f <- df_analysis_female %>%
  group_by(study, arms_maternal) %>%
  summarise(
    prevalence_severe_wasted = mean(severe_wasted == 1, na.rm = TRUE)
  ) 

# Calculate the overall prevalence of 'severe_stunted' by study
overall_prevalence_severe_wasted_f <- df_analysis_female %>%
  group_by(study) %>%
  summarise(
    prevalence_severe_wasted = mean(severe_wasted == 1, na.rm = TRUE))  # Calculate the prevalence

# Create the lollipop plot
plot_severe_wasting_f <- #ggplot(prevalence_values_severe_wasted, 
                               #aes(x = study, y = prevalence_severe_wasted*100, 
                                       # color = arms_maternal)) +
            ggplot(prevalence_values_severe_wasted_f, 
                   aes(x = reorder(study, prevalence_severe_wasted*100), 
                                        y = prevalence_severe_wasted*100, 
                                        color = arms_maternal)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
            scale_shape_manual(name = "SQ-LNS", 
                               values = c("Control" = 16, "SQ-LNS" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Severe wasting (%, female)", 
                 color = "SQ-LNS",
                 shape = "SQ-LNS", fill = "SQ-LNS") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(0,60))


plot_severe_wasting_f

```

Severe wasting male

```{r severe wasting male, echo = TRUE, warning = FALSE}

# Create the 'severe_wasted' variable
df_analysis_male <- df_analysis_male %>%
  mutate(severe_wasted = case_when(wlz_el < -3 ~ 1, 
                                    wlz_el >= -3 ~ 0))


# Calculate the prevalence of 'severe_wasted' by study
prevalence_values_severe_wasted_m <- df_analysis_male %>%
  group_by(study, arms_maternal) %>%
  summarise(
    prevalence_severe_wasted = mean(severe_wasted == 1, na.rm = TRUE)
  ) 

# Calculate the overall prevalence of 'severe_stunted' by study
overall_prevalence_severe_wasted_m <- df_analysis_male %>%
  group_by(study) %>%
  summarise(
    prevalence_severe_wasted = mean(severe_wasted == 1, na.rm = TRUE))  # Calculate the prevalence

# Create the lollipop plot
plot_severe_wasting_m <- #ggplot(prevalence_values_severe_wasted, 
                               #aes(x = study, y = prevalence_severe_wasted*100, 
                                       # color = arms_maternal)) +
            ggplot(prevalence_values_severe_wasted_m, 
                   aes(x = reorder(study, prevalence_severe_wasted*100), 
                                        y = prevalence_severe_wasted*100, 
                                        color = arms_maternal)) +
            geom_segment(aes(xend = study, yend = 0), color = "black") +
            geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
            scale_shape_manual(name = "SQ-LNS", 
                               values = c("Control" = 16, "SQ-LNS" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Severe wasting (%, male)", 
                 color = "SQ-LNS",
                 shape = "SQ-LNS", fill = "SQ-LNS") +
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) + ylim(c(0,60))


plot_severe_wasting_m

```


```{r save plot 6, echo = TRUE, warning = FALSE}
# Save the plot as a PNG
#ggsave(here::here("output","lollipop_plot_severe_wasting_el_maternal.png"), plot = plot_severe_wasting, width = 10, height = 6, dpi = 300)

plot_severe_wasting <- plot_severe_wasting_f + plot_severe_wasting_m
plot_severe_wasting

```

Combining plots

```{r combine plots 5, echo = TRUE, warning = FALSE}

# Combine the plots
#combined_plots_laz <- grid.arrange(plot_laz, plot_stunted, plot_severe_stunting, ncol = 3, nrow = 1)

#combinedd_plots_wlz <- grid.arrange(plot_wlz, plot_wasted, plot_severe_wasting, ncol = 3, nrow = 1)

#combined_laz_wlz <- grid.arrange(combined_plots_laz, combinedd_plots_wlz, ncol = 1, nrow = 2)


combined_laz_plot <- plot_laz / plot_stunted / plot_severe_stunting 
combined_wlz_plot <-plot_wlz / plot_wasted / plot_severe_wasting

combined_laz_plot
combined_wlz_plot

```

```{r save combined plots 5, echo = TRUE, warning = FALSE}

# Save the combined plots as a PNG
#ggsave(here::here("output","combined_lollipop_laz_wlz_maternal.png"), plot = combined_laz_wlz, width = 15, height = 10, dpi = 300)

ggsave(here::here("output","bysex_lollipop_laz_maternal.png"), plot = combined_laz_plot, width = 10, height = 12, dpi = 300)

ggsave(here::here("output","bysex_lollipop_wlz_maternal.png"), plot = combined_wlz_plot, width = 10, height = 12, dpi = 300)

```



## Developmental outcomes

Language score female

```{r language score female, echo = TRUE, warning = FALSE}

# Calculate the mean language score
mean_values_d1_lang_el_f <- df_analysis_female %>%
  filter(!is.na(d1_lang_el)) %>%  # Filter out NA values in 'd1_lang_el'
  group_by(region, study, arms_maternal) %>%
  summarise(
    mean_d1_lang_el = mean(d1_lang_el, na.rm = TRUE)
  ) 

# Calculate the overall mean d1_lang_el by study
overall_means_d1_lang_f <- df_analysis_female %>%
  group_by(study) %>%
  summarise(
    overall_mean_d1_lang_el = mean(d1_lang_el, na.rm = TRUE)
  )

# Create the lollipop plot
#plot_lang_score <- #ggplot(mean_values_wlz, aes(x = study, y = mean_wlz_el, 
  #                                      #color = arms_maternal)) +
  #          ggplot(mean_values_d1_lang_el, aes(x = reorder(study, -mean_d1_lang_el), 
  #                                      y = mean_d1_lang_el, color = arms_maternal)) +
  #          geom_segment(aes(xend = study, yend = 0), color = "black") +
  #          geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
   #         scale_shape_manual(name = "Maternal intervention", 
   #                            values = c("Control" = 16, "Maternal intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
    #        scale_color_manual(values = c('darkgrey','darkblue')) + 
    #        scale_fill_manual(values = c('darkgrey','darkblue')) + 
    #        theme_minimal() +
    #        coord_flip() +  # Make the plot horizontal
    #        labs(x = "Study", y = "Mean language score at endline", 
    #             color = "Maternal intervention",
    #             shape = "Maternal intervention", fill = "Maternal intervention") +
    #        theme(legend.position = "bottom",
    #              legend.title = element_blank(),
    #              axis.title.y = element_text(size = 18),
    #              axis.title.x = element_text(size = 18),
    #              strip.text = element_text(face="bold", size=14, hjust = 0.5),
    #              axis.text.y = element_text(face="bold",  size=12),
    #              axis.text.x = element_text(face="bold",  size=12),
     #             legend.key.size = unit(1, "cm"),
      #            legend.key.width = unit(1,"cm"),
      #            legend.text=element_text(size=10, hjust = 0)) + ylim(c(-0.3,0.13))

# Create the circular barplot
plot_lang_score_f <- ggplot(mean_values_d1_lang_el_f, aes(x=as.factor(study), y=mean_d1_lang_el)) +      
  geom_bar(stat="identity", aes(fill=arms_maternal)) +
  scale_fill_manual(values = c('darkgrey','darkblue')) + 
  # Limits of the plot = very important. The negative value controls the size of the inner circle, the positive one is useful to add size over each bar
  ylim(-0.3,0.3) +
  theme_minimal() +
  labs(x = "Mean language score (female)", 
       #y = "Mean language score", 
       color = "SQ-LNS",
       shape = "SQ-LNS", fill = "SQ-LNS") +
  theme(legend.position = "right",
        legend.title = element_blank(),
        axis.title.y = element_blank(),
        axis.title.x = element_text(size = 12),
        strip.text = element_text(face="bold", size=10, hjust = 0.5),
        axis.text.y = element_text(face="bold",  size=10),
        axis.text.x = element_text(face="bold",  size=10),
        legend.key.size = unit(1, "cm"),
        legend.key.width = unit(1,"cm"),
        legend.text=element_text(size=10, hjust = 0)) +
  geom_hline(yintercept = 0, linetype = "solid", size = 0.5, color = "black") +  # Add bold line at y = 0
  # This makes the coordinate polar instead of cartesian.
  coord_polar(start = 0) 
  


plot_lang_score_f

```


Language score male
```{r language score male, echo = TRUE, warning = FALSE}

# Calculate the mean language score
mean_values_d1_lang_el_m <- df_analysis_male %>%
  filter(!is.na(d1_lang_el)) %>%  # Filter out NA values in 'd1_lang_el'
  group_by(region, study, arms_maternal) %>%
  summarise(
    mean_d1_lang_el = mean(d1_lang_el, na.rm = TRUE)
  ) 

# Calculate the overall mean d1_lang_el by study
overall_means_d1_lang_m <- df_analysis_male %>%
  group_by(study) %>%
  summarise(
    overall_mean_d1_lang_el = mean(d1_lang_el, na.rm = TRUE)
  )

# Create the lollipop plot
#plot_lang_score <- #ggplot(mean_values_wlz, aes(x = study, y = mean_wlz_el, 
  #                                      #color = arms_maternal)) +
  #          ggplot(mean_values_d1_lang_el, aes(x = reorder(study, -mean_d1_lang_el), 
  #                                      y = mean_d1_lang_el, color = arms_maternal)) +
  #          geom_segment(aes(xend = study, yend = 0), color = "black") +
  #          geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
   #         scale_shape_manual(name = "Maternal intervention", 
   #                            values = c("Control" = 16, "Maternal intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
    #        scale_color_manual(values = c('darkgrey','darkblue')) + 
    #        scale_fill_manual(values = c('darkgrey','darkblue')) + 
    #        theme_minimal() +
    #        coord_flip() +  # Make the plot horizontal
    #        labs(x = "Study", y = "Mean language score at endline", 
    #             color = "Maternal intervention",
    #             shape = "Maternal intervention", fill = "Maternal intervention") +
    #        theme(legend.position = "bottom",
    #              legend.title = element_blank(),
    #              axis.title.y = element_text(size = 18),
    #              axis.title.x = element_text(size = 18),
    #              strip.text = element_text(face="bold", size=14, hjust = 0.5),
    #              axis.text.y = element_text(face="bold",  size=12),
    #              axis.text.x = element_text(face="bold",  size=12),
     #             legend.key.size = unit(1, "cm"),
      #            legend.key.width = unit(1,"cm"),
      #            legend.text=element_text(size=10, hjust = 0)) + ylim(c(-0.3,0.13))

# Create the circular barplot
plot_lang_score_m <- ggplot(mean_values_d1_lang_el_m, aes(x=as.factor(study), y=mean_d1_lang_el)) +      
  geom_bar(stat="identity", aes(fill=arms_maternal)) +
  scale_fill_manual(values = c('darkgrey','darkblue')) + 
  # Limits of the plot = very important. The negative value controls the size of the inner circle, the positive one is useful to add size over each bar
  ylim(-0.3,0.3) +
  theme_minimal() +
  labs(x = "Mean language score (male)", 
       #y = "Mean language score", 
       color = "SQ-LNS",
       shape = "SQ-LNS", fill = "SQ-LNS") +
  theme(legend.position = "right",
        legend.title = element_blank(),
        axis.title.y = element_blank(),
        axis.title.x = element_text(size = 12),
        strip.text = element_text(face="bold", size=10, hjust = 0.5),
        axis.text.y = element_text(face="bold",  size=10),
        axis.text.x = element_text(face="bold",  size=10),
        legend.key.size = unit(1, "cm"),
        legend.key.width = unit(1,"cm"),
        legend.text=element_text(size=10, hjust = 0)) +
  geom_hline(yintercept = 0, linetype = "solid", size = 0.5, color = "black") +  # Add bold line at y = 0
  # This makes the coordinate polar instead of cartesian.
  coord_polar(start = 0) 
  


plot_lang_score_m

```


```{r save plot 7, echo = TRUE, warning = FALSE}
# Save the plot as a PNG

#ggsave(here::here("output","lollipop_plot_lang_score_el_maternal.png"), plot = plot_lang_score, width = 10, height = 6, dpi = 300)

plot_lang_score <- plot_lang_score_f + plot_lang_score_m
plot_lang_score


```

Gross motor skill female

```{r gross motor skill female, echo = TRUE, warning = FALSE}

# Calculate the mean gross motor skill score d8_grossmotor_el
mean_values_d8_grossmotor_el_f <- df_analysis_female %>%
  filter(!is.na(d8_grossmotor_el)) %>%  # Filter out NA values in 'd8_grossmotor_el'
  group_by(study, arms_maternal) %>%
  summarise(
    mean_d8_grossmotor_el = mean(d8_grossmotor_el, na.rm = TRUE)
  ) 

# Calculate the overall mean d8_grossmotor_el by study
overall_means_d8_grossmotor_f <- df_analysis_female %>%
  group_by(study) %>%
  summarise(
    overall_mean_d8_grossmotor_el = mean(d8_grossmotor_el, na.rm = TRUE)
  )

# Create the lollipop plot
#plot_gross_motor <- #ggplot(mean_values_wlz, aes(x = study, y = mean_wlz_el, 
 #                                       #color = arms_maternal)) +
  #          ggplot(mean_values_d8_grossmotor_el, 
  #                 aes(x = reorder(study, -mean_d8_grossmotor_el), 
  #                                      y = mean_d8_grossmotor_el, 
  #                     color = arms_maternal)) +
   #         geom_segment(aes(xend = study, yend = 0), color = "black") +
   #         geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
   #         scale_shape_manual(name = "Maternal intervention", 
   #                            values = c("Control" = 16, "Maternal intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
   #         scale_color_manual(values = c('darkgrey','darkblue')) + 
   #         scale_fill_manual(values = c('darkgrey','darkblue')) + 
   #         theme_minimal() +
   #         coord_flip() +  # Make the plot horizontal
   #         labs(x = "Study", y = "Mean gross motor score at endline", 
   #              color = "Maternal intervention",
   #              shape = "Maternal intervention", fill = "Maternal intervention") +
    #        theme(legend.position = "bottom",
     #             legend.title = element_blank(),
      #            axis.title.y = element_text(size = 18),
      #            axis.title.x = element_text(size = 18),
      #            strip.text = element_text(face="bold", size=14, hjust = 0.5),
      #            axis.text.y = element_text(face="bold",  size=12),
      #            axis.text.x = element_text(face="bold",  size=12),
      #            legend.key.size = unit(1, "cm"),
      #            legend.key.width = unit(1,"cm"),
      #            legend.text=element_text(size=10, hjust = 0)) + ylim(c(-0.3,0.13))

# Create the circular barplot
plot_gross_motor_f <- ggplot(mean_values_d8_grossmotor_el_f, aes(x=as.factor(study), y=mean_d8_grossmotor_el)) +      
  geom_bar(stat="identity", aes(fill=arms_maternal)) +
  scale_fill_manual(values = c('darkgrey','darkblue')) + 
  # Limits of the plot = very important. The negative value controls the size of the inner circle, the positive one is useful to add size over each bar
  ylim(-0.3,0.3) +
  theme_minimal() +
  labs(x = "Mean gross motor score (female)", 
       #y = "Mean gross motor score", 
       color = "SQ-LNS",
       shape = "SQ-LNS", fill = "SQ-LNS") +
  theme(legend.position = "right",
        legend.title = element_blank(),
        axis.title.y = element_blank(),
        axis.title.x = element_text(size = 12),
        strip.text = element_text(face="bold", size=10, hjust = 0.5),
        axis.text.y = element_text(face="bold",  size=10),
        axis.text.x = element_text(face="bold",  size=10),
        legend.key.size = unit(1, "cm"),
        legend.key.width = unit(1,"cm"),
        legend.text=element_text(size=10, hjust = 0)) +
  geom_hline(yintercept = 0, linetype = "solid", size = 0.5, color = "black") +  # Add bold line at y = 0
  # This makes the coordinate polar instead of cartesian.
coord_polar(start = 0)


plot_gross_motor_f
                                                    
```


Gross motor male

```{r gross motor skill male, echo = TRUE, warning = FALSE}

# Calculate the mean gross motor skill score d8_grossmotor_el
mean_values_d8_grossmotor_el_m <- df_analysis_male %>%
  filter(!is.na(d8_grossmotor_el)) %>%  # Filter out NA values in 'd8_grossmotor_el'
  group_by(study, arms_maternal) %>%
  summarise(
    mean_d8_grossmotor_el = mean(d8_grossmotor_el, na.rm = TRUE)
  ) 

# Calculate the overall mean d8_grossmotor_el by study
overall_means_d8_grossmotor_m <- df_analysis_male %>%
  group_by(study) %>%
  summarise(
    overall_mean_d8_grossmotor_el = mean(d8_grossmotor_el, na.rm = TRUE)
  )

# Create the lollipop plot
#plot_gross_motor <- #ggplot(mean_values_wlz, aes(x = study, y = mean_wlz_el, 
 #                                       #color = arms_maternal)) +
  #          ggplot(mean_values_d8_grossmotor_el, 
  #                 aes(x = reorder(study, -mean_d8_grossmotor_el), 
  #                                      y = mean_d8_grossmotor_el, 
  #                     color = arms_maternal)) +
   #         geom_segment(aes(xend = study, yend = 0), color = "black") +
   #         geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
   #         scale_shape_manual(name = "Maternal intervention", 
   #                            values = c("Control" = 16, "Maternal intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
   #         scale_color_manual(values = c('darkgrey','darkblue')) + 
   #         scale_fill_manual(values = c('darkgrey','darkblue')) + 
   #         theme_minimal() +
   #         coord_flip() +  # Make the plot horizontal
   #         labs(x = "Study", y = "Mean gross motor score at endline", 
   #              color = "Maternal intervention",
   #              shape = "Maternal intervention", fill = "Maternal intervention") +
    #        theme(legend.position = "bottom",
     #             legend.title = element_blank(),
      #            axis.title.y = element_text(size = 18),
      #            axis.title.x = element_text(size = 18),
      #            strip.text = element_text(face="bold", size=14, hjust = 0.5),
      #            axis.text.y = element_text(face="bold",  size=12),
      #            axis.text.x = element_text(face="bold",  size=12),
      #            legend.key.size = unit(1, "cm"),
      #            legend.key.width = unit(1,"cm"),
      #            legend.text=element_text(size=10, hjust = 0)) + ylim(c(-0.3,0.13))

# Create the circular barplot
plot_gross_motor_m <- ggplot(mean_values_d8_grossmotor_el_m, aes(x=as.factor(study), y=mean_d8_grossmotor_el)) +      
  geom_bar(stat="identity", aes(fill=arms_maternal)) +
  scale_fill_manual(values = c('darkgrey','darkblue')) + 
  # Limits of the plot = very important. The negative value controls the size of the inner circle, the positive one is useful to add size over each bar
  ylim(-0.3,0.3) +
  theme_minimal() +
  labs(x = "Mean gross motor score (male)", 
       #y = "Mean gross motor score", 
       color = "SQ-LNS",
       shape = "SQ-LNS", fill = "SQ-LNS") +
  theme(legend.position = "right",
        legend.title = element_blank(),
        axis.title.y = element_blank(),
        axis.title.x = element_text(size = 12),
        strip.text = element_text(face="bold", size=10, hjust = 0.5),
        axis.text.y = element_text(face="bold",  size=10),
        axis.text.x = element_text(face="bold",  size=10),
        legend.key.size = unit(1, "cm"),
        legend.key.width = unit(1,"cm"),
        legend.text=element_text(size=10, hjust = 0)) +
  geom_hline(yintercept = 0, linetype = "solid", size = 0.5, color = "black") +  # Add bold line at y = 0
  # This makes the coordinate polar instead of cartesian.
coord_polar(start = 0)


plot_gross_motor_m
                                                    
```





```{r save plot 8, echo = TRUE, warning = FALSE}
# Save the plot as a PNG

#ggsave(here::here("output","lollipop_plot_gross_motor_el_maternal.png"), plot = plot_gross_motor, width = 10, height = 6, dpi = 300)

plot_gross_motor <- plot_gross_motor_f + plot_gross_motor_m
plot_gross_motor



```

Fine motor skill female

```{r fine motor skill female, echo = TRUE, warning = FALSE}

# Calculate the mean fine motor skill score d10_finemotor_el
mean_values_d10_finemotor_el_f <- df_analysis_female %>%
  group_by(study, arms_maternal) %>%
  summarise(
    mean_d10_finemotor_el = mean(d10_finemotor_el, na.rm = TRUE)
  ) 

# Calculate the overall mean d10_finemotor_el by study
overall_means_d10_finemotor_f <- df_analysis_female %>%
  group_by(study) %>%
  summarise(
    overall_mean_d10_finemotor_el = mean(d10_finemotor_el, na.rm = TRUE)
  )

# Create the lollipop plot
#plot_fine_motor <- ggplot(mean_values_d10_finemotor_el, 
 #                  aes(x = reorder(study, -mean_d10_finemotor_el), 
 #                                       y = mean_d10_finemotor_el, 
  #                     color = arms_maternal)) +
  #          geom_segment(aes(xend = study, yend = 0), color = "black") +
  #          geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
  #          scale_shape_manual(name = "Maternal intervention", 
   #                            values = c("Control" = 16, "Maternal intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
   #         scale_color_manual(values = c('darkgrey','darkblue')) + 
   #         scale_fill_manual(values = c('darkgrey','darkblue')) + 
   #         theme_minimal() +
   #         coord_flip() +  # Make the plot horizontal
   #         labs(x = "Study", y = "Mean fine motor score at endline", 
   #              color = "Maternal intervention",
  #               shape = "Maternal intervention", fill = "Maternal intervention") +
   #         theme(legend.position = "bottom",
   #               legend.title = element_blank(),
   #               axis.title.y = element_text(size = 18),
   #               axis.title.x = element_text(size = 18),
   #               strip.text = element_text(face="bold", size=14, hjust = 0.5),
   #               axis.text.y = element_text(face="bold",  size=12),
   #               axis.text.x = element_text(face="bold",  size=12),
   #               legend.key.size = unit(1, "cm"),
   #               legend.key.width = unit(1,"cm"),
   #               legend.text=element_text(size=10, hjust = 0)) + ylim(c(-0.3,0.13))

# Create the circular barplot
plot_fine_motor_f <- ggplot(mean_values_d10_finemotor_el_f, aes(x=as.factor(study), y=mean_d10_finemotor_el)) +      
  geom_bar(stat="identity", aes(fill=arms_maternal)) +
  scale_fill_manual(values = c('darkgrey','darkblue')) + 
  # Limits of the plot = very important. The negative value controls the size of the inner circle, the positive one is useful to add size over each bar
  ylim(-0.3,0.3) +
  theme_minimal() +
  labs(x = "Mean fine motor score (female)", 
       #y = "Mean gross motor score", 
       color = "SQ-LNS",
       shape = "SQ-LNS", fill = "SQ-LNS") +
  theme(legend.position = "right",
        legend.title = element_blank(),
        axis.title.y = element_blank(),
        axis.title.x = element_text(size = 12),
        strip.text = element_text(face="bold", size=10, hjust = 0.5),
        axis.text.y = element_text(face="bold",  size=10),
        axis.text.x = element_text(face="bold",  size=10),
        legend.key.size = unit(1, "cm"),
        legend.key.width = unit(1,"cm"),
        legend.text=element_text(size=10, hjust = 0)) +
   geom_hline(yintercept = 0, linetype = "solid", size = 0.5, color = "black") +  # Add bold line at y = 0
  # This makes the coordinate polar instead of cartesian.
coord_polar(start = 0)


plot_fine_motor_f
                                                    
```


Fine motor male

```{r fine motor skill male, echo = TRUE, warning = FALSE}

# Calculate the mean fine motor skill score d10_finemotor_el
mean_values_d10_finemotor_el_m <- df_analysis_male %>%
  group_by(study, arms_maternal) %>%
  summarise(
    mean_d10_finemotor_el = mean(d10_finemotor_el, na.rm = TRUE)
  ) 

# Calculate the overall mean d10_finemotor_el by study
overall_means_d10_finemotor_m <- df_analysis_male %>%
  group_by(study) %>%
  summarise(
    overall_mean_d10_finemotor_el = mean(d10_finemotor_el, na.rm = TRUE)
  )

# Create the lollipop plot
#plot_fine_motor <- ggplot(mean_values_d10_finemotor_el, 
 #                  aes(x = reorder(study, -mean_d10_finemotor_el), 
 #                                       y = mean_d10_finemotor_el, 
  #                     color = arms_maternal)) +
  #          geom_segment(aes(xend = study, yend = 0), color = "black") +
  #          geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
  #          scale_shape_manual(name = "Maternal intervention", 
   #                            values = c("Control" = 16, "Maternal intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
   #         scale_color_manual(values = c('darkgrey','darkblue')) + 
   #         scale_fill_manual(values = c('darkgrey','darkblue')) + 
   #         theme_minimal() +
   #         coord_flip() +  # Make the plot horizontal
   #         labs(x = "Study", y = "Mean fine motor score at endline", 
   #              color = "Maternal intervention",
  #               shape = "Maternal intervention", fill = "Maternal intervention") +
   #         theme(legend.position = "bottom",
   #               legend.title = element_blank(),
   #               axis.title.y = element_text(size = 18),
   #               axis.title.x = element_text(size = 18),
   #               strip.text = element_text(face="bold", size=14, hjust = 0.5),
   #               axis.text.y = element_text(face="bold",  size=12),
   #               axis.text.x = element_text(face="bold",  size=12),
   #               legend.key.size = unit(1, "cm"),
   #               legend.key.width = unit(1,"cm"),
   #               legend.text=element_text(size=10, hjust = 0)) + ylim(c(-0.3,0.13))

# Create the circular barplot
plot_fine_motor_m <- ggplot(mean_values_d10_finemotor_el_m, aes(x=as.factor(study), y=mean_d10_finemotor_el)) +      
  geom_bar(stat="identity", aes(fill=arms_maternal)) +
  scale_fill_manual(values = c('darkgrey','darkblue')) + 
  # Limits of the plot = very important. The negative value controls the size of the inner circle, the positive one is useful to add size over each bar
  ylim(-0.3,0.3) +
  theme_minimal() +
  labs(x = "Mean fine motor score (male)", 
       #y = "Mean gross motor score", 
       color = "SQ-LNS",
       shape = "SQ-LNS", fill = "SQ-LNS") +
  theme(legend.position = "right",
        legend.title = element_blank(),
        axis.title.y = element_blank(),
        axis.title.x = element_text(size = 12),
        strip.text = element_text(face="bold", size=10, hjust = 0.5),
        axis.text.y = element_text(face="bold",  size=10),
        axis.text.x = element_text(face="bold",  size=10),
        legend.key.size = unit(1, "cm"),
        legend.key.width = unit(1,"cm"),
        legend.text=element_text(size=10, hjust = 0)) +
   geom_hline(yintercept = 0, linetype = "solid", size = 0.5, color = "black") +  # Add bold line at y = 0
  # This makes the coordinate polar instead of cartesian.
coord_polar(start = 0)


plot_fine_motor_m
                                                    
```



```{r save plot 9, echo = TRUE, warning = FALSE}
# Save the plot as a PNG

#ggsave(here::here("output","lollipop_plot_fine_motor_el_maternal.png"), plot = plot_fine_motor, width = 10, height = 6, dpi = 300)

plot_fine_motor <- plot_fine_motor_f + plot_fine_motor_m
plot_fine_motor

```


Executive function score female

```{r executive function score female, echo = TRUE, warning = FALSE}

# Calculate the mean executive function score d12_execfun_el
mean_values_d12_execfun_el_f <- df_analysis_female %>%
  group_by(study, arms_maternal) %>%
  summarise(
    mean_d12_execfun_el = mean(d12_execfun_el, na.rm = TRUE)
  ) 

# Calculate the overall mean d12_execfun_el by study
overall_means_d12_execfun_f <- df_analysis_female %>%
  group_by(study) %>%
  summarise(
    overall_mean_d12_execfun_el = mean(d12_execfun_el, na.rm = TRUE)
  )

# Create the lollipop plot
#plot_exec_fun <- ggplot(mean_values_d12_execfun_el, 
  #                 aes(x = reorder(study, -mean_d12_execfun_el), 
  #                                      y = mean_d12_execfun_el, 
  #                     color = arms_maternal)) +
  #          geom_segment(aes(xend = study, yend = 0), color = "black") +
  #          geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
  #          scale_shape_manual(name = "Maternal intervention", 
   #                            values = c("Control" = 16, "Maternal intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
   #         scale_color_manual(values = c('darkgrey','darkblue')) + 
   #         scale_fill_manual(values = c('darkgrey','darkblue')) + 
   #         theme_minimal() +
   #         coord_flip() +  # Make the plot horizontal
   #         labs(x = "Study", y = "Mean executive function score at endline", 
   #              color = "Maternal intervention",
   #              shape = "Maternal intervention", fill = "Maternal intervention") +
   #         theme(legend.position = "bottom",
   #               legend.title = element_blank(),
    #              axis.title.y = element_text(size = 18),
    #              axis.title.x = element_text(size = 18),
    #              strip.text = element_text(face="bold", size=14, hjust = 0.5),
    #              axis.text.y = element_text(face="bold",  size=12),
     #             axis.text.x = element_text(face="bold",  size=12),
     #             legend.key.size = unit(1, "cm"),
     #             legend.key.width = unit(1,"cm"),
      #            legend.text=element_text(size=10, hjust = 0)) + ylim(c(-0.3,0.13))

# Create the circular barplot
plot_exec_fun_f <- ggplot(mean_values_d12_execfun_el_f, aes(x=as.factor(study), y=mean_d12_execfun_el)) +      
  geom_bar(stat="identity", aes(fill=arms_maternal)) +
  scale_fill_manual(values = c('darkgrey','darkblue')) + 
  # Limits of the plot = very important. The negative value controls the size of the inner circle, the positive one is useful to add size over each bar
  ylim(-0.3,0.3) +
  theme_minimal() +
  labs(x = "Mean executive function score (female)", 
       #y = "Mean gross motor score", 
       color = "SQ-LNS",
       shape = "SQ-LNS", fill = "SQ-LNS") +
  theme(legend.position = "right",
        legend.title = element_blank(),
        axis.title.y = element_blank(),
        axis.title.x = element_text(size = 12),
        strip.text = element_text(face="bold", size=10, hjust = 0.5),
        axis.text.y = element_text(face="bold",  size=10),
        axis.text.x = element_text(face="bold",  size=10),
        legend.key.size = unit(1, "cm"),
        legend.key.width = unit(1,"cm"),
        legend.text=element_text(size=10, hjust = 0)) +
   geom_hline(yintercept = 0, linetype = "solid", size = 0.5, color = "black") +  # Add bold line at y = 0
  # This makes the coordinate polar instead of cartesian.
coord_polar(start = 0)


plot_exec_fun_f

```

Executive function male

```{r executive function score male, echo = TRUE, warning = FALSE}

# Calculate the mean executive function score d12_execfun_el
mean_values_d12_execfun_el_m <- df_analysis_male %>%
  group_by(study, arms_maternal) %>%
  summarise(
    mean_d12_execfun_el = mean(d12_execfun_el, na.rm = TRUE)
  ) 

# Calculate the overall mean d12_execfun_el by study
overall_means_d12_execfun_m <- df_analysis_male %>%
  group_by(study) %>%
  summarise(
    overall_mean_d12_execfun_el = mean(d12_execfun_el, na.rm = TRUE)
  )

# Create the lollipop plot
#plot_exec_fun <- ggplot(mean_values_d12_execfun_el, 
  #                 aes(x = reorder(study, -mean_d12_execfun_el), 
  #                                      y = mean_d12_execfun_el, 
  #                     color = arms_maternal)) +
  #          geom_segment(aes(xend = study, yend = 0), color = "black") +
  #          geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
  #          scale_shape_manual(name = "Maternal intervention", 
   #                            values = c("Control" = 16, "Maternal intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
   #         scale_color_manual(values = c('darkgrey','darkblue')) + 
   #         scale_fill_manual(values = c('darkgrey','darkblue')) + 
   #         theme_minimal() +
   #         coord_flip() +  # Make the plot horizontal
   #         labs(x = "Study", y = "Mean executive function score at endline", 
   #              color = "Maternal intervention",
   #              shape = "Maternal intervention", fill = "Maternal intervention") +
   #         theme(legend.position = "bottom",
   #               legend.title = element_blank(),
    #              axis.title.y = element_text(size = 18),
    #              axis.title.x = element_text(size = 18),
    #              strip.text = element_text(face="bold", size=14, hjust = 0.5),
    #              axis.text.y = element_text(face="bold",  size=12),
     #             axis.text.x = element_text(face="bold",  size=12),
     #             legend.key.size = unit(1, "cm"),
     #             legend.key.width = unit(1,"cm"),
      #            legend.text=element_text(size=10, hjust = 0)) + ylim(c(-0.3,0.13))

# Create the circular barplot
plot_exec_fun_m <- ggplot(mean_values_d12_execfun_el_m, aes(x=as.factor(study), y=mean_d12_execfun_el)) +      
  geom_bar(stat="identity", aes(fill=arms_maternal)) +
  scale_fill_manual(values = c('darkgrey','darkblue')) + 
  # Limits of the plot = very important. The negative value controls the size of the inner circle, the positive one is useful to add size over each bar
  ylim(-0.3,0.3) +
  theme_minimal() +
  labs(x = "Mean executive function score (male)", 
       #y = "Mean gross motor score", 
       color = "SQ-LNS",
       shape = "SQ-LNS", fill = "SQ-LNS") +
  theme(legend.position = "right",
        legend.title = element_blank(),
        axis.title.y = element_blank(),
        axis.title.x = element_text(size = 12),
        strip.text = element_text(face="bold", size=10, hjust = 0.5),
        axis.text.y = element_text(face="bold",  size=10),
        axis.text.x = element_text(face="bold",  size=10),
        legend.key.size = unit(1, "cm"),
        legend.key.width = unit(1,"cm"),
        legend.text=element_text(size=10, hjust = 0)) +
   geom_hline(yintercept = 0, linetype = "solid", size = 0.5, color = "black") +  # Add bold line at y = 0
  # This makes the coordinate polar instead of cartesian.
coord_polar(start = 0)


plot_exec_fun_m

```

```{r save plot 10, echo = TRUE, warning = FALSE}
# Save the plot as a PNG

#ggsave(here::here("output","lollipop_plot_exec_fun_el_maternal.png"), plot = plot_exec_fun, width = 10, height = 6, dpi = 300)

plot_exec_fun <- plot_exec_fun_f + plot_exec_fun_m
plot_exec_fun

```

Socioemotional score female

```{r socioemotional score female, echo = TRUE, warning = FALSE}

# Calculate the mean socioemotional score d5_socioemo_el
mean_values_d5_socioemo_el_f <- df_analysis_female %>%
  group_by(study, arms_maternal) %>%
  summarise(
    mean_d5_socioemo_el = mean(d5_socioemo_el, na.rm = TRUE)
  ) 

# Calculate the overall mean d12_execfun_el by study
overall_means_d5_socioemo_f <- df_analysis_female %>%
  group_by(study) %>%
  summarise(
    overall_mean_d5_socioemo_el = mean(d5_socioemo_el, na.rm = TRUE)
  )

# Create the lollipop plot
#plot_socioemo <- ggplot(mean_values_d5_socioemo_el, 
   #                aes(x = reorder(study, -mean_d5_socioemo_el), 
      #                                  y = mean_d5_socioemo_el, 
      #                 color = arms_maternal)) +
      #      geom_segment(aes(xend = study, yend = 0), color = "black") +
      #      geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
      #      scale_shape_manual(name = "Maternal intervention", 
      #                         values = c("Control" = 16, "Maternal intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
      #      scale_color_manual(values = c('darkgrey','darkblue')) + 
      #      scale_fill_manual(values = c('darkgrey','darkblue')) + 
      #      theme_minimal() +
      #      coord_flip() +  # Make the plot horizontal
      #      labs(x = "Study", y = "Mean socioemotional score at endline", 
       #          color = "Maternal intervention",
       #          shape = "Maternal intervention", fill = "Maternal intervention") +
       #     theme(legend.position = "bottom",
        #          legend.title = element_blank(),
        #          axis.title.y = element_text(size = 18),
        #          axis.title.x = element_text(size = 18),
        #          strip.text = element_text(face="bold", size=14, hjust = 0.5),
         #         axis.text.y = element_text(face="bold",  size=12),
         #         axis.text.x = element_text(face="bold",  size=12),
          #        legend.key.size = unit(1, "cm"),
          #        legend.key.width = unit(1,"cm"),
          #        legend.text=element_text(size=10, hjust = 0)) + ylim(c(-0.3,0.13))

# Create the circular barplot
plot_socioemo_f <- ggplot(mean_values_d5_socioemo_el_f, aes(x=as.factor(study), y=mean_d5_socioemo_el)) +      
  geom_bar(stat="identity", aes(fill=arms_maternal)) +
  scale_fill_manual(values = c('darkgrey','darkblue')) + 
  # Limits of the plot = very important. The negative value controls the size of the inner circle, the positive one is useful to add size over each bar
  ylim(-0.3,0.3) +
  theme_minimal() +
  labs(x = "Mean socioemotional score (female)", 
       #y = "Mean gross motor score", 
       color = "SQ-LNS",
       shape = "SQ-LNS", fill = "SQ-LNS") +
  theme(legend.position = "right",
        legend.title = element_blank(),
        axis.title.y = element_blank(),
        axis.title.x = element_text(size = 12),
        strip.text = element_text(face="bold", size=10, hjust = 0.5),
        axis.text.y = element_text(face="bold",  size=10),
        axis.text.x = element_text(face="bold",  size=10),
        legend.key.size = unit(1, "cm"),
        legend.key.width = unit(1,"cm"),
        legend.text=element_text(size=10, hjust = 0)) +
   geom_hline(yintercept = 0, linetype = "solid", size = 0.5, color = "black") +  # Add bold line at y = 0
  # This makes the coordinate polar instead of cartesian.
coord_polar(start = 0)

plot_socioemo_f

```


Socio emotional male

```{r socioemotional score male, echo = TRUE, warning = FALSE}

# Calculate the mean socioemotional score d5_socioemo_el
mean_values_d5_socioemo_el_m <- df_analysis_male %>%
  group_by(study, arms_maternal) %>%
  summarise(
    mean_d5_socioemo_el = mean(d5_socioemo_el, na.rm = TRUE)
  ) 

# Calculate the overall mean d12_execfun_el by study
overall_means_d5_socioemo_m <- df_analysis_male %>%
  group_by(study) %>%
  summarise(
    overall_mean_d5_socioemo_el = mean(d5_socioemo_el, na.rm = TRUE)
  )

# Create the lollipop plot
#plot_socioemo <- ggplot(mean_values_d5_socioemo_el, 
   #                aes(x = reorder(study, -mean_d5_socioemo_el), 
      #                                  y = mean_d5_socioemo_el, 
      #                 color = arms_maternal)) +
      #      geom_segment(aes(xend = study, yend = 0), color = "black") +
      #      geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
      #      scale_shape_manual(name = "Maternal intervention", 
      #                         values = c("Control" = 16, "Maternal intervention" = 17)) +  # 16 is the shape code for circle, 17 for triangle
      #      scale_color_manual(values = c('darkgrey','darkblue')) + 
      #      scale_fill_manual(values = c('darkgrey','darkblue')) + 
      #      theme_minimal() +
      #      coord_flip() +  # Make the plot horizontal
      #      labs(x = "Study", y = "Mean socioemotional score at endline", 
       #          color = "Maternal intervention",
       #          shape = "Maternal intervention", fill = "Maternal intervention") +
       #     theme(legend.position = "bottom",
        #          legend.title = element_blank(),
        #          axis.title.y = element_text(size = 18),
        #          axis.title.x = element_text(size = 18),
        #          strip.text = element_text(face="bold", size=14, hjust = 0.5),
         #         axis.text.y = element_text(face="bold",  size=12),
         #         axis.text.x = element_text(face="bold",  size=12),
          #        legend.key.size = unit(1, "cm"),
          #        legend.key.width = unit(1,"cm"),
          #        legend.text=element_text(size=10, hjust = 0)) + ylim(c(-0.3,0.13))

# Create the circular barplot
plot_socioemo_m <- ggplot(mean_values_d5_socioemo_el_m, aes(x=as.factor(study), y=mean_d5_socioemo_el)) +      
  geom_bar(stat="identity", aes(fill=arms_maternal)) +
  scale_fill_manual(values = c('darkgrey','darkblue')) + 
  # Limits of the plot = very important. The negative value controls the size of the inner circle, the positive one is useful to add size over each bar
  ylim(-0.3,0.3) +
  theme_minimal() +
  labs(x = "Mean socioemotional score (male)", 
       #y = "Mean gross motor score", 
       color = "SQ-LNS",
       shape = "SQ-LNS", fill = "SQ-LNS") +
  theme(legend.position = "right",
        legend.title = element_blank(),
        axis.title.y = element_blank(),
        axis.title.x = element_text(size = 12),
        strip.text = element_text(face="bold", size=10, hjust = 0.5),
        axis.text.y = element_text(face="bold",  size=10),
        axis.text.x = element_text(face="bold",  size=10),
        legend.key.size = unit(1, "cm"),
        legend.key.width = unit(1,"cm"),
        legend.text=element_text(size=10, hjust = 0)) +
   geom_hline(yintercept = 0, linetype = "solid", size = 0.5, color = "black") +  # Add bold line at y = 0
  # This makes the coordinate polar instead of cartesian.
coord_polar(start = 0)

plot_socioemo_m

```

```{r save plot 11, echo = TRUE, warning = FALSE}
# Save the plot as a PNG

#ggsave(here::here("output","lollipop_plot_socioemo_el_maternal.png"), plot = plot_socioemo, width = 10, height = 6, dpi = 300)

plot_socioemo <- plot_socioemo_f + plot_socioemo_m
plot_socioemo

```

Combined plots

```{r combine plots 12, echo = TRUE, warning = FALSE}

# Combine the plots
#combined_plots_dev <- grid.arrange(plot_lang_score, plot_gross_motor, plot_fine_motor, plot_exec_fun, plot_socioemo, ncol = 2)

combined_plots_dev <- plot_lang_score / plot_gross_motor / plot_fine_motor / plot_exec_fun / plot_socioemo


```

```{r save combined plots 13, echo = TRUE, warning = FALSE}
# Save the combined plots as a PNG
ggsave(here::here("output","bysex_plots_dev_el_maternal.png"), plot = combined_plots_dev, width = 15, height = 19, dpi = 300)

```


## Anemia

Hemoglobin concentration female

```{r hemoglobin female, echo = TRUE, warning = FALSE}

# Calculate the mean hemoglobin concentration b1_hb_el by study 
mean_values_hb_f <- df_analysis_female %>% 
  group_by(study, arms_maternal) %>%
  summarise(
    mean_b1_hb_el = mean(b1_hb_el, na.rm = TRUE)
  ) 

# Calculate the overall mean d12_execfun_el by study
overall_means_b1_hb_f <- df_analysis_female %>%
  group_by(study) %>%
  summarise(
    overall_mean_b1_hb_el = mean(b1_hb_el, na.rm = TRUE)
  )


# Create the lollipop plot
plot_hb_f <- ggplot(mean_values_hb_f, 
                   aes(x = reorder(study, -mean_b1_hb_el), 
                                        y = mean_b1_hb_el, 
                       color = arms_maternal)) +
            geom_segment(aes(xend = study, yend = 110), color = "black") +
            geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
            scale_shape_manual(name = "SQ-LNS", 
                               values = c("Control" = 16, "SQ-LNS" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Mean hemoglobin concentration (female)", 
                 color = "SQ-LNS",
                 shape = "SQ-LNS", fill = "SQ-LNS") +
            scale_y_continuous(breaks = seq(0, 130, by = 10)) +  # Set y-axis breaks by 10
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) 

plot_hb_f


```

Hemoglobin concentration male

```{r hemoglobin male, echo = TRUE, warning = FALSE}

# Calculate the mean hemoglobin concentration b1_hb_el by study 
mean_values_hb_m <- df_analysis_male %>% 
  group_by(study, arms_maternal) %>%
  summarise(
    mean_b1_hb_el = mean(b1_hb_el, na.rm = TRUE)
  ) 

# Calculate the overall mean d12_execfun_el by study
overall_means_b1_hb_m <- df_analysis_male %>%
  group_by(study) %>%
  summarise(
    overall_mean_b1_hb_el = mean(b1_hb_el, na.rm = TRUE)
  )


# Create the lollipop plot
plot_hb_m <- ggplot(mean_values_hb_m, 
                   aes(x = reorder(study, -mean_b1_hb_el), 
                                        y = mean_b1_hb_el, 
                       color = arms_maternal)) +
            geom_segment(aes(xend = study, yend = 110), color = "black") +
            geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
            scale_shape_manual(name = "SQ-LNS", 
                               values = c("Control" = 16, "SQ-LNS" = 17)) +  # 16 is the shape code for circle, 17 for triangle
            scale_color_manual(values = c('darkgrey','darkblue')) + 
            scale_fill_manual(values = c('darkgrey','darkblue')) + 
            theme_minimal() +
            coord_flip() +  # Make the plot horizontal
            labs(x = "Study", y = "Mean hemoglobin concentration (male)", 
                 color = "SQ-LNS",
                 shape = "SQ-LNS", fill = "SQ-LNS") +
            scale_y_continuous(breaks = seq(0, 130, by = 10)) +  # Set y-axis breaks by 10
            theme(legend.position = "bottom",
                  legend.title = element_blank(),
                  axis.title.y = element_text(size = 18),
                  axis.title.x = element_text(size = 18),
                  strip.text = element_text(face="bold", size=14, hjust = 0.5),
                  axis.text.y = element_text(face="bold",  size=12),
                  axis.text.x = element_text(face="bold",  size=12),
                  legend.key.size = unit(1, "cm"),
                  legend.key.width = unit(1,"cm"),
                  legend.text=element_text(size=10, hjust = 0)) 

plot_hb_m


```

```{r save plot 14, echo = TRUE, warning = FALSE}
# Save the plot as a PNG

#ggsave(here::here("output","lollipop_plot_hb_el_maternal.png"), plot = plot_hb, width = 10, height = 6, dpi = 300)

plot_hb <- plot_hb_f + plot_hb_m
plot_hb

```

Anemia prevalence female

```{r anemia prevalence female, echo = TRUE, warning = FALSE}

# Calculate the prevalence of anemia b2_anemia_el

prevalence_b2_anemia_el_f <- df_analysis_female %>%
  group_by(study, arms_maternal) %>%
  summarise(
    prevalence_b2_anemia_el = mean(b2_anemia_el == 1, na.rm = TRUE)  # Calculate the prevalence
  ) 

# Calculate the overall prevalence of wasted_el by study
overall_prevalence_anemia_f <- df_analysis_female %>%
  group_by(study) %>%
  summarise(
    overall_prevalence_anemia = mean(b2_anemia_el == 1, na.rm = TRUE)  # Calculate the prevalence
  )

# Create the lollipop plot
plot_anemia_f <- ggplot(prevalence_b2_anemia_el_f, 
                      aes(x = reorder(study, prevalence_b2_anemia_el * 100), 
                          y = prevalence_b2_anemia_el * 100, 
                          color = arms_maternal)) +
  geom_segment(aes(xend = study, yend = 0), color = "black") +
  geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
  scale_shape_manual(name = "SQ-LNS", 
                     values = c("Control" = 16, "SQ-LNS" = 17)) +  # 16 is the shape code for circle, 17 for triangle
  scale_color_manual(values = c('darkgrey', 'darkblue')) + 
  scale_fill_manual(values = c('darkgrey', 'darkblue')) + 
  theme_minimal() +
  coord_flip() +  # Make the plot horizontal
  labs(x = "Study", y = "Anemia (%, female)", 
       color = "SQ-LNS",
       shape = "SQ-LNS", fill = "SQ-LNS") +
  scale_y_continuous(breaks = seq(0, 100, by = 10)) +  # Set y-axis breaks by 10
  theme(legend.position = "bottom",
        legend.title = element_blank(),
        axis.title.y = element_text(size = 18),
        axis.title.x = element_text(size = 18),
        strip.text = element_text(face = "bold", size = 14, hjust = 0.5),
        axis.text.y = element_text(face = "bold", size = 12),
        axis.text.x = element_text(face = "bold", size = 12),
        legend.key.size = unit(1, "cm"),
        legend.key.width = unit(1, "cm"),
        legend.text = element_text(size = 10, hjust = 0))


plot_anemia_f

```

Anemia prevalence male

```{r anemia prevalence male, echo = TRUE, warning = FALSE}

# Calculate the prevalence of anemia b2_anemia_el

prevalence_b2_anemia_el_m <- df_analysis_male %>%
  group_by(study, arms_maternal) %>%
  summarise(
    prevalence_b2_anemia_el = mean(b2_anemia_el == 1, na.rm = TRUE)  # Calculate the prevalence
  ) 

# Calculate the overall prevalence of wasted_el by study
overall_prevalence_anemia_m <- df_analysis_male %>%
  group_by(study) %>%
  summarise(
    overall_prevalence_anemia = mean(b2_anemia_el == 1, na.rm = TRUE)  # Calculate the prevalence
  )

# Create the lollipop plot
plot_anemia_m <- ggplot(prevalence_b2_anemia_el_m, 
                      aes(x = reorder(study, prevalence_b2_anemia_el * 100), 
                          y = prevalence_b2_anemia_el * 100, 
                          color = arms_maternal)) +
  geom_segment(aes(xend = study, yend = 0), color = "black") +
  geom_point(aes(shape = as.factor(arms_maternal)), size = 3) +
  scale_shape_manual(name = "SQ-LNS", 
                     values = c("Control" = 16, "SQ-LNS" = 17)) +  # 16 is the shape code for circle, 17 for triangle
  scale_color_manual(values = c('darkgrey', 'darkblue')) + 
  scale_fill_manual(values = c('darkgrey', 'darkblue')) + 
  theme_minimal() +
  coord_flip() +  # Make the plot horizontal
  labs(x = "Study", y = "Anemia (%, male)", 
       color = "SQ-LNS",
       shape = "SQ-LNS", fill = "SQ-LNS") +
  scale_y_continuous(breaks = seq(0, 100, by = 10)) +  # Set y-axis breaks by 10
  theme(legend.position = "bottom",
        legend.title = element_blank(),
        axis.title.y = element_text(size = 18),
        axis.title.x = element_text(size = 18),
        strip.text = element_text(face = "bold", size = 14, hjust = 0.5),
        axis.text.y = element_text(face = "bold", size = 12),
        axis.text.x = element_text(face = "bold", size = 12),
        legend.key.size = unit(1, "cm"),
        legend.key.width = unit(1, "cm"),
        legend.text = element_text(size = 10, hjust = 0))


plot_anemia_m

```



```{r save plot 15, echo = TRUE, warning = FALSE}
# Save the plot as a PNG

#ggsave(here::here("output","lollipop_plot_anemia_el_maternal.png"), plot = plot_anemia, width = 10, height = 6, dpi = 300)

plot_anemia <- plot_anemia_f + plot_anemia_m
plot_anemia

```


Combined plots

```{r combine plots 16, echo = TRUE, warning = FALSE}

# Combine the plots
#combined_plots_anemia <- grid.arrange(plot_hb, plot_anemia, ncol = 2, nrow = 1)

combined_plots_anemia <- plot_hb / plot_anemia
combined_plots_anemia

```

```{r save combined plots 17, echo = TRUE, warning = FALSE}
# Save the combined plots as a PNG
#ggsave(here::here("output","combined_plots_anemia_el_maternal.png"), plot = combined_plots_anemia, width = 12, height = 6, dpi = 300)

ggsave(here::here("output","bysex_plots_anemia_el_maternal.png"), plot = combined_plots_anemia, width = 12, height = 9, dpi = 300)

```


Session info

```{r session info, echo = TRUE, warning = FALSE}
sessionInfo()
  
```





